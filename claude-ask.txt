-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.app_links (
  id integer NOT NULL DEFAULT nextval('app_links_id_seq'::regclass),
  name character varying NOT NULL,
  url text NOT NULL,
  display_order integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT app_links_pkey PRIMARY KEY (id)
);
CREATE TABLE public.clients (
  id integer NOT NULL DEFAULT nextval('clients_id_seq'::regclass),
  name character varying NOT NULL,
  fiscal_month integer CHECK (fiscal_month >= 1 AND fiscal_month <= 12),
  staff_id integer,
  accounting_method character varying DEFAULT '記帳代行'::character varying,
  status character varying DEFAULT 'active'::character varying,
  custom_tasks_by_year jsonb DEFAULT '{}'::jsonb,
  finalized_years jsonb DEFAULT '[]'::jsonb,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT clients_pkey PRIMARY KEY (id),
  CONSTRAINT clients_staff_id_fkey FOREIGN KEY (staff_id) REFERENCES public.staffs(id)
);
CREATE TABLE public.default_tasks (
  id integer NOT NULL DEFAULT nextval('default_tasks_id_seq'::regclass),
  task_name character varying,
  accounting_method character varying,
  tasks jsonb,
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT default_tasks_pkey PRIMARY KEY (id)
);
CREATE TABLE public.editing_sessions (
  id integer NOT NULL DEFAULT nextval('editing_sessions_id_seq'::regclass),
  client_id integer,
  user_id character varying NOT NULL,
  started_at timestamp without time zone DEFAULT now(),
  last_activity timestamp without time zone DEFAULT now(),
  CONSTRAINT editing_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT editing_sessions_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.monthly_tasks (
  id integer NOT NULL DEFAULT nextval('monthly_tasks_id_seq'::regclass),
  client_id integer,
  month character varying NOT NULL,
  tasks jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'pending'::character varying,
  url text,
  memo text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  task_memos jsonb DEFAULT '{}'::jsonb,
  completed boolean NOT NULL DEFAULT false,
  CONSTRAINT monthly_tasks_pkey PRIMARY KEY (id),
  CONSTRAINT monthly_tasks_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.settings (
  key character varying NOT NULL,
  value jsonb NOT NULL,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT settings_pkey PRIMARY KEY (key)
);
CREATE TABLE public.staffs (
  id integer NOT NULL DEFAULT nextval('staffs_id_seq'::regclass),
  name character varying NOT NULL,
  email character varying,
  role character varying DEFAULT 'staff'::character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT staffs_pkey PRIMARY KEY (id)
);