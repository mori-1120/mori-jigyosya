● Update(analytics.js)
  ⎿  Updated analytics.js with 16 additions and 4 removals
       721 
       722                // 各月のタスクレコード内のJSONタスクを計算
       723                monthTasks.forEach(monthlyTask => {
       724 -                  if (monthlyTask.tasks && typeof monthlyTask.tasks === 'object') {
       725 -                      const tasksList = Object.values(monthlyTask.tasks);
       724 +                  let tasksObj = monthlyTask.tasks;
       725 +  
       726 +                  // tasksが文字列の場合はJSONパース
       727 +                  if (typeof tasksObj === 'string') {
       728 +                      try {
       729 +                          tasksObj = JSON.parse(tasksObj);
       730 +                      } catch (e) {
       731 +                          console.warn(`[ANALYTICS] JSON parse error for client ${clientId}, month ${monthlyTask.month}:`, e);
       732 +                          return;
       733 +                      }
       734 +                  }
       735 +  
       736 +                  if (tasksObj && typeof tasksObj === 'object') {
       737 +                      const tasksList = Object.values(tasksObj);
       738                        totalTasks += tasksList.length;
       739 -
       740 -                      const completedCount = tasksList.filter(task => task === true || task === '完了').length;
       739 +  
       740 +                      const completedCount = tasksList.filter(task => task.completed === true).length;
       741                        completedTasks += completedCount;
       742                    }
       743                });