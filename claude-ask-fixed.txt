ğŸ“‹ 1000ä»¶åˆ¶é™ä¿®æ­£ã®å®Œå…¨ã¾ã¨ã‚ - 2025å¹´9æœˆ24æ—¥ä¿®æ­£å®Œäº†

ğŸ¯ ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

1. supabase-client.js
2. supabase/functions/daily-backup/index.ts

ğŸ”§ ä¿®æ­£å®Œäº†ã—ãŸé–¢æ•°ãƒ»ç®‡æ‰€

1. getMonthlyTasks() é–¢æ•° (è¡Œ199-251)

ä¿®æ­£å‰:
const { data, error } = await query
    .order('month', { ascending: false })
    .order('id', { ascending: true });

ä¿®æ­£å¾Œ:
// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã§å…¨ä»¶å–å¾—ï¼ˆ1000ä»¶åˆ¶é™å›é¿ï¼‰
let allData = [];
let from = 0;
const batchSize = 1000;

while (true) {
    const { data, error } = await supabase
        .from('monthly_tasks')
        .select('*')
        .order('client_id', { ascending: true })
        .order('month', { ascending: false })
        .order('completed', { ascending: false })
        .order('id', { ascending: true })
        .range(from, from + batchSize - 1);

    if (!data || data.length === 0) break;
    allData = allData.concat(data);
    if (data.length < batchSize) break;
    from += batchSize;
}

2. getAllMonthlyTasksForAllClients() é–¢æ•° (è¡Œ267-306)

ä¿®æ­£å‰: åˆ¶é™ãªã—ã®å˜ç´”å–å¾—
ä¿®æ­£å¾Œ: åŒæ§˜ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

3. createFullBackup() é–¢æ•° (è¡Œ1540-1602)

ä¿®æ­£å‰:
const { data, error } = await supabase
    .from(tableName)
    .select('*');

ä¿®æ­£å¾Œ:
// monthly_tasksãƒ†ãƒ¼ãƒ–ãƒ«ã®å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
if (tableName === 'monthly_tasks') {
    while (true) {
        const { data, error } = await supabase
            .from(tableName)
            .select('*')
            .order('client_id', { ascending: true })
            .order('month', { ascending: false })
            .order('completed', { ascending: false })
            .order('id', { ascending: true })
            .range(from, from + batchSize - 1);
        // ãƒãƒƒãƒå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
    }
} else {
    // ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯é€šå¸¸å–å¾—
}

4. daily-backup Edge Functions (è¡Œ44-98)

ä¿®æ­£å‰: å˜ç´”å–å¾—
ä¿®æ­£å¾Œ: monthly_tasksã«å¯¾ã—ã¦ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

âš¡ ä¿®æ­£å†…å®¹ã®ãƒã‚¤ãƒ³ãƒˆ

1. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…: 1000ä»¶ãšã¤ãƒãƒƒãƒå‡¦ç†
2. è¤‡æ•°ã‚½ãƒ¼ãƒˆæ¡ä»¶å¯¾å¿œ: ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ç¢ºä¿
3. è©³ç´°ãƒ­ã‚°è¿½åŠ : å–å¾—çŠ¶æ³ã®å¯è¦–åŒ–
4. å…¨é–¢æ•°çµ±ä¸€: åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§çµ±ä¸€
5. è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾å¿œ: Edge Functionsã«ã‚‚åŒæ§˜ã®å®Ÿè£…

ğŸŠ åŠ¹æœ

- ä¿®æ­£å‰: 1000ä»¶ã§åœæ­¢
- ä¿®æ­£å¾Œ: ç„¡åˆ¶é™ï¼ˆ3000ä»¶â†’30000ä»¶ã§ã‚‚å¯¾å¿œå¯èƒ½ï¼‰
- æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: âœ… å¯¾å¿œå®Œäº†
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: âœ… å¯¾å¿œå®Œäº†

âœ… ã“ã‚Œã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒãƒ»è¡¨ç¤ºã™ã¹ã¦ãŒ1000ä»¶åˆ¶é™ã‹ã‚‰è§£æ”¾ã•ã‚Œã¾ã—ãŸï¼